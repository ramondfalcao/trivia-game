{"ast":null,"code":"var _jsxFileName = \"/home/ramond/Documentos/projetos-trybe/sd-019-a-project-trivia-react-redux/src/components/Question.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { fetchQuestions, scoreAction } from '../redux/actions';\nimport Loading from './Loading';\nimport gravatarAPI from '../services/gravatarAPI';\nimport './Question.css';\nimport timerImg from \"../assets/timerImg.svg\";\n\nclass Question extends Component {\n  constructor() {\n    super();\n\n    this.handleTimer = () => {\n      const oneSecond = 1000;\n      this.intervalID = setInterval(() => {\n        this.setState(prevState => ({\n          timer: prevState.timer === 0 ? 0 : prevState.timer - 1\n        }), () => {\n          const {\n            timer\n          } = this.state;\n\n          if (timer === 0) {\n            this.setState({\n              timeout: true\n            });\n            clearInterval(this.intervalID);\n          }\n        });\n      }, oneSecond);\n    };\n\n    this.getQuestions = async () => {\n      const {\n        dispatchFetchQuestions,\n        token\n      } = this.props;\n      const {\n        index\n      } = this.state;\n      await dispatchFetchQuestions(token);\n      const {\n        propsQuestions\n      } = this.props;\n      this.setState({\n        questions: propsQuestions.results,\n        loading: false\n      }, () => {\n        const {\n          questions\n        } = this.state;\n        this.shuffleAlternatives(questions[index]);\n      });\n    };\n\n    this.shuffleArray = array => {\n      for (let i = array.length - 1; i > 0; i -= 1) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [array[i], array[j]] = [array[j], array[i]];\n      }\n\n      return array;\n    };\n\n    this.shuffleAlternatives = object => {\n      let alternatives = object.incorrect_answers.map(answer => ({\n        answer,\n        isCorrectAnswer: false,\n        difficulty: object.difficulty\n      }));\n      alternatives = [...alternatives, {\n        answer: object.correct_answer,\n        isCorrectAnswer: true,\n        difficulty: object.difficulty\n      }];\n      const shuffledArray = this.shuffleArray(alternatives);\n      this.setState({\n        shuffledAlternatives: shuffledArray\n      });\n    };\n\n    this.calculatePoints = async (difficulty, answerTime) => {\n      const {\n        dispatchScore\n      } = this.props;\n      const standardPoint = 10;\n      const hardPoint = 3;\n      const mediumPoint = 2;\n      const easyPoint = 1;\n      let totalScore;\n\n      switch (difficulty) {\n        case 'hard':\n          totalScore = standardPoint + answerTime * hardPoint;\n          break;\n\n        case 'medium':\n          totalScore = standardPoint + answerTime * mediumPoint;\n          break;\n\n        case 'easy':\n          totalScore = standardPoint + answerTime * easyPoint;\n          break;\n\n        default:\n          return 0;\n      }\n\n      this.setState(prevState => ({\n        score: prevState.score + totalScore\n      }));\n      dispatchScore(totalScore);\n    };\n\n    this.handleAnswerClick = e => {\n      e.preventDefault();\n      const {\n        target: {\n          value,\n          name\n        }\n      } = e;\n      this.setState({\n        correctAlt: 'CorrectAns',\n        incorrectAlt: 'IncorrectAns',\n        isClicked: true,\n        timer: 0\n      });\n\n      if (value === 'correct') {\n        const {\n          timer\n        } = this.state;\n        this.calculatePoints(name, timer);\n      }\n    };\n\n    this.handleRanking = () => {\n      const urlImage = gravatarAPI();\n      const {\n        score\n      } = this.state;\n      const {\n        name\n      } = this.props;\n      let users = JSON.parse(localStorage.getItem('users')) || [];\n      const user = {\n        name,\n        score,\n        picture: urlImage\n      };\n      users = [...users, user];\n      localStorage.setItem('users', JSON.stringify(users));\n    };\n\n    this.handleNextButton = () => {\n      const maxQuestion = 4;\n      const {\n        index\n      } = this.state;\n      const {\n        history\n      } = this.props;\n\n      if (index === maxQuestion) {\n        this.handleRanking();\n        history.push('/feedback');\n      } else {\n        this.setState(prevState => ({\n          index: prevState.index + 1,\n          timer: 30,\n          timeout: false,\n          correctAlt: '',\n          incorrectAlt: ''\n        }), () => {\n          this.handleNextQuestion();\n        });\n      }\n    };\n\n    this.handleNextQuestion = () => {\n      const {\n        index,\n        questions\n      } = this.state;\n      this.handleTimer();\n      this.shuffleAlternatives(questions[index]);\n    };\n\n    this.renderAlternatives = () => {\n      const {\n        correctAlt,\n        incorrectAlt,\n        shuffledAlternatives,\n        timeout\n      } = this.state;\n      return shuffledAlternatives.map((alternative, i) => /*#__PURE__*/React.createElement(\"button\", {\n        key: i,\n        type: \"button\",\n        name: alternative.difficulty,\n        disabled: timeout,\n        className: alternative.isCorrectAnswer ? correctAlt : incorrectAlt,\n        \"data-testid\": alternative.isCorrectAnswer ? 'correct-answer' : `wrong-answer-${i}`,\n        value: alternative.isCorrectAnswer ? 'correct' : 'wrong',\n        onClick: this.handleAnswerClick,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 9\n        }\n      }, alternative.answer));\n    };\n\n    this.state = {\n      questions: [],\n      shuffledAlternatives: [],\n      index: 0,\n      loading: true,\n      correctAlt: '',\n      incorrectAlt: '',\n      timer: 30,\n      timeout: false,\n      isClicked: false,\n      score: 0\n    };\n  }\n\n  componentDidMount() {\n    this.getQuestions();\n    this.handleTimer();\n  }\n\n  render() {\n    const {\n      questions,\n      index,\n      loading,\n      timer,\n      isClicked\n    } = this.state;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"quiz-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"questions-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 9\n      }\n    }, loading ? /*#__PURE__*/React.createElement(Loading, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 15\n      }\n    }) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"category\",\n      \"data-testid\": \"question-category\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 17\n      }\n    }, questions[index].category), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"question\",\n      \"data-testid\": \"question-text\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 17\n      }\n    }, questions[index].question), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"alternatives\",\n      \"data-testid\": \"answer-options\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 17\n      }\n    }, this.renderAlternatives()), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: \"timer-img\",\n      src: timerImg,\n      alt: \"timer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 19\n      }\n    }, timer))), isClicked && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"div-btn-next\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      className: \"btn-next\",\n      \"data-testid\": \"btn-next\",\n      onClick: this.handleNextButton,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 15\n      }\n    }, \"Next\"))));\n  }\n\n}\n\nconst mapStateToProps = state => ({\n  token: state.token,\n  propsQuestions: state.trivia.payload,\n  name: state.player.name\n});\n\nconst mapDispatchToProps = dispatch => ({\n  dispatchFetchQuestions: token => dispatch(fetchQuestions(token)),\n  dispatchScore: score => dispatch(scoreAction(score))\n});\n\nQuestion.defaultProps = {\n  propsQuestions: {}\n};\nQuestion.propTypes = {\n  dispatchFetchQuestions: PropTypes.func.isRequired,\n  token: PropTypes.string.isRequired,\n  propsQuestions: PropTypes.objectOf(PropTypes.any),\n  dispatchScore: PropTypes.func.isRequired,\n  history: PropTypes.objectOf(PropTypes.any).isRequired,\n  name: PropTypes.string.isRequired\n};\nexport default connect(mapStateToProps, mapDispatchToProps)(Question);","map":{"version":3,"sources":["/home/ramond/Documentos/projetos-trybe/sd-019-a-project-trivia-react-redux/src/components/Question.js"],"names":["React","Component","PropTypes","connect","fetchQuestions","scoreAction","Loading","gravatarAPI","Question","constructor","handleTimer","oneSecond","intervalID","setInterval","setState","prevState","timer","state","timeout","clearInterval","getQuestions","dispatchFetchQuestions","token","props","index","propsQuestions","questions","results","loading","shuffleAlternatives","shuffleArray","array","i","length","j","Math","floor","random","object","alternatives","incorrect_answers","map","answer","isCorrectAnswer","difficulty","correct_answer","shuffledArray","shuffledAlternatives","calculatePoints","answerTime","dispatchScore","standardPoint","hardPoint","mediumPoint","easyPoint","totalScore","score","handleAnswerClick","e","preventDefault","target","value","name","correctAlt","incorrectAlt","isClicked","handleRanking","urlImage","users","JSON","parse","localStorage","getItem","user","picture","setItem","stringify","handleNextButton","maxQuestion","history","push","handleNextQuestion","renderAlternatives","alternative","componentDidMount","render","category","question","timerImg","mapStateToProps","trivia","payload","player","mapDispatchToProps","dispatch","defaultProps","propTypes","func","isRequired","string","objectOf","any"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { fetchQuestions, scoreAction } from '../redux/actions';\nimport Loading from './Loading';\nimport gravatarAPI from '../services/gravatarAPI';\nimport './Question.css';\nimport timerImg from '../assets/timerImg.svg';\n\nclass Question extends Component {\n  constructor() {\n    super();\n    this.state = {\n      questions: [],\n      shuffledAlternatives: [],\n      index: 0,\n      loading: true,\n      correctAlt: '',\n      incorrectAlt: '',\n      timer: 30,\n      timeout: false,\n      isClicked: false,\n      score: 0,\n    };\n  }\n\n  componentDidMount() {\n    this.getQuestions();\n    this.handleTimer();\n  }\n\n  handleTimer = () => {\n    const oneSecond = 1000;\n    this.intervalID = setInterval(() => {\n      this.setState((prevState) => ({ timer: prevState.timer === 0\n        ? 0 : prevState.timer - 1 }), () => {\n        const { timer } = this.state;\n        if (timer === 0) {\n          this.setState({ timeout: true });\n          clearInterval(this.intervalID);\n        }\n      });\n    }, oneSecond);\n  }\n\n  getQuestions = async () => {\n    const { dispatchFetchQuestions, token } = this.props;\n    const { index } = this.state;\n    await dispatchFetchQuestions(token);\n    const { propsQuestions } = this.props;\n    this.setState({ questions: propsQuestions.results, loading: false }, () => {\n      const { questions } = this.state;\n      this.shuffleAlternatives(questions[index]);\n    });\n  }\n\n  // https://www.horadecodar.com.br/2021/05/10/como-embaralhar-um-array-em-javascript-shuffle/\n  shuffleArray = (array) => {\n    for (let i = array.length - 1; i > 0; i -= 1) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [array[i], array[j]] = [array[j], array[i]];\n    }\n    return array;\n  }\n\n  shuffleAlternatives = (object) => {\n    let alternatives = object.incorrect_answers.map((answer) => ({\n      answer,\n      isCorrectAnswer: false,\n      difficulty: object.difficulty,\n    }));\n\n    alternatives = [...alternatives, {\n      answer: object.correct_answer,\n      isCorrectAnswer: true,\n      difficulty: object.difficulty }];\n\n    const shuffledArray = this.shuffleArray(alternatives);\n    this.setState({ shuffledAlternatives: shuffledArray });\n  }\n\n  calculatePoints = async (difficulty, answerTime) => {\n    const { dispatchScore } = this.props;\n\n    const standardPoint = 10;\n    const hardPoint = 3;\n    const mediumPoint = 2;\n    const easyPoint = 1;\n    let totalScore;\n\n    switch (difficulty) {\n    case 'hard':\n      totalScore = (standardPoint + (answerTime * hardPoint));\n      break;\n    case 'medium':\n      totalScore = (standardPoint + (answerTime * mediumPoint));\n      break;\n    case 'easy':\n      totalScore = (standardPoint + (answerTime * easyPoint));\n      break;\n    default:\n      return 0;\n    }\n    this.setState((prevState) => ({ score: prevState.score + totalScore }));\n    dispatchScore(totalScore);\n  }\n\n  handleAnswerClick = (e) => {\n    e.preventDefault();\n    const { target: { value, name } } = e;\n    this.setState({\n      correctAlt: 'CorrectAns',\n      incorrectAlt: 'IncorrectAns',\n      isClicked: true,\n      timer: 0,\n    });\n\n    if (value === 'correct') {\n      const { timer } = this.state;\n      this.calculatePoints(name, timer);\n    }\n  }\n\n  handleRanking = () => {\n    const urlImage = gravatarAPI();\n    const { score } = this.state;\n    const { name } = this.props;\n\n    let users = JSON.parse(localStorage.getItem('users')) || [];\n    const user = {\n      name,\n      score,\n      picture: urlImage,\n    };\n    users = [...users, user];\n    localStorage.setItem('users', JSON.stringify(users));\n  }\n\n  handleNextButton = () => {\n    const maxQuestion = 4;\n    const { index } = this.state;\n    const { history } = this.props;\n    if (index === maxQuestion) {\n      this.handleRanking();\n      history.push('/feedback');\n    } else {\n      this.setState((prevState) => ({\n        index: prevState.index + 1,\n        timer: 30,\n        timeout: false,\n        correctAlt: '',\n        incorrectAlt: '',\n      }), () => {\n        this.handleNextQuestion();\n      });\n    }\n  }\n\n  handleNextQuestion = () => {\n    const { index, questions } = this.state;\n    this.handleTimer();\n    this.shuffleAlternatives(questions[index]);\n  }\n\n  renderAlternatives = () => {\n    const { correctAlt, incorrectAlt, shuffledAlternatives, timeout } = this.state;\n    return shuffledAlternatives\n      .map((alternative, i) => (\n        <button\n          key={ i }\n          type=\"button\"\n          name={ alternative.difficulty }\n          disabled={ timeout }\n          className={ alternative.isCorrectAnswer\n            ? correctAlt\n            : incorrectAlt }\n          data-testid={ alternative.isCorrectAnswer\n            ? 'correct-answer' : `wrong-answer-${i}` }\n          value={ alternative.isCorrectAnswer\n            ? 'correct' : 'wrong' }\n          onClick={ this.handleAnswerClick }\n        >\n          { alternative.answer }\n        </button>\n      ));\n  }\n\n  render() {\n    const { questions,\n      index,\n      loading,\n      timer,\n      isClicked,\n    } = this.state;\n\n    return (\n      <div className=\"quiz-container\">\n        <div className=\"questions-container\">\n          { loading\n            ? <Loading />\n            : (\n              <>\n                <p\n                  className=\"category\"\n                  data-testid=\"question-category\"\n                >\n                  {questions[index].category}\n                </p>\n                <p\n                  className=\"question\"\n                  data-testid=\"question-text\"\n                >\n                  {questions[index].question}\n                </p>\n                <div className=\"alternatives\" data-testid=\"answer-options\">\n                  { this.renderAlternatives() }\n                </div>\n                <div>\n                  <img className=\"timer-img\" src={ timerImg } alt=\"timer\" />\n                  <p>{ timer }</p>\n                </div>\n              </>\n            ) }\n          {isClicked && (\n            <div className=\"div-btn-next\">\n              <button\n                type=\"button\"\n                className=\"btn-next\"\n                data-testid=\"btn-next\"\n                onClick={ this.handleNextButton }\n              >\n                Next\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n\nconst mapStateToProps = (state) => ({\n  token: state.token,\n  propsQuestions: state.trivia.payload,\n  name: state.player.name,\n});\n\nconst mapDispatchToProps = (dispatch) => ({\n  dispatchFetchQuestions: (token) => dispatch(fetchQuestions(token)),\n  dispatchScore: (score) => dispatch(scoreAction(score)),\n});\n\nQuestion.defaultProps = ({\n  propsQuestions: {},\n});\n\nQuestion.propTypes = ({\n  dispatchFetchQuestions: PropTypes.func.isRequired,\n  token: PropTypes.string.isRequired,\n  propsQuestions: PropTypes.objectOf(PropTypes.any),\n  dispatchScore: PropTypes.func.isRequired,\n  history: PropTypes.objectOf(PropTypes.any).isRequired,\n  name: PropTypes.string.isRequired,\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Question);\n"]},"metadata":{},"sourceType":"module"}